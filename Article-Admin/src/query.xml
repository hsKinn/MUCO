<?xml version="1.0" encoding="UTF-8"?>
<query>
	<member>
		<singleDeleteInfo>
			DELETE
			FROM    MEMBERS 
			WHERE   MEMBER_ID = ?
		</singleDeleteInfo>
		<multiDeleteInfo>
			DELETE
			FROM    MEMBERS 
			WHERE   MEMBER_ID = ?
		</multiDeleteInfo>
		<getInfoDetail>
				SELECT  MEMBER_ID
				        , NICK_NAME
				        , PASSWORD
				        , EMAIL
				        , IS_ADMIN
				FROM    MEMBERS
				WHERE   MEMBER_ID = ?	
		</getInfoDetail>
		<invalidCheckNickName>
			SELECT  COUNT(NICK_NAME)
			FROM    MEMBERS
			WHERE   NICK_NAME = ?
		</invalidCheckNickName>
		<getMemberByIdAndPassword>
				SELECT 	MEMBER_ID
						, NICK_NAME
						, PASSWORD
						, EMAIL
						, IS_ADMIN
				FROM 	MEMBERS
				WHERE	MEMBER_ID = ?
				AND		PASSWORD = ?
				AND		IS_ADMIN = 'Y'
		</getMemberByIdAndPassword>
		<insertNewMember>
				INSERT	INTO	MEMBERS	( 
											MEMBER_ID
											, NICK_NAME
											, PASSWORD
											, EMAIL 
										) 
				VALUES 					( 
											MEMBER_ID_SEQ.NEXTVAL
											, ? 
											, ? 
											, ? 
										)
		</insertNewMember>
		<allMember>
				SELECT	*
				FROM	(
							SELECT	ROWNUM AS RNUM
									, A.*
							FROM	(
										SELECT  MEMBER_ID
                                                , NICK_NAME
												, PASSWORD
                                                , EMAIL
                                                , IS_ADMIN
										FROM    MEMBERS
										WHERE	MEMBER_ID LIKE '%' || ? || '%'
										AND     NICK_NAME LIKE '%' || ? || '%'
										GROUP   BY  MEMBER_ID
                                                    , NICK_NAME
                                                    , PASSWORD
                                                    , EMAIL
                                                    , IS_ADMIN
										ORDER   BY  MEMBER_ID DESC
									) A
							WHERE	ROWNUM &lt;= ?
						)
				WHERE	RNUM &gt;= ?
		</allMember>
		<searchNickName>
				SELECT	*
				FROM	(
							SELECT	ROWNUM AS RNUM
									, A.*
							FROM	(
										SELECT  MEMBER_ID
                                                , NICK_NAME
												, PASSWORD
                                                , EMAIL
                                                , IS_ADMIN
										FROM    MEMBERS
										WHERE	NICK_NAME LIKE '%' || ? || '%'
										GROUP   BY  MEMBER_ID
                                                    , NICK_NAME
                                                    , PASSWORD
                                                    , EMAIL
                                                    , IS_ADMIN
										ORDER   BY  MEMBER_ID DESC
									) A
							WHERE	ROWNUM &lt;= ?
						)
				WHERE	RNUM &gt;= ?
		</searchNickName>
		<searchEmail>
				SELECT	*
				FROM	(
							SELECT	ROWNUM AS RNUM
									, A.*
							FROM	(
										SELECT  MEMBER_ID
                                                , NICK_NAME
												, PASSWORD
                                                , EMAIL
                                                , IS_ADMIN
										FROM    MEMBERS
										WHERE	EMAIL LIKE '%' || ? || '%'
										GROUP   BY  MEMBER_ID
                                                    , NICK_NAME
                                                    , PASSWORD
                                                    , EMAIL
                                                    , IS_ADMIN
										ORDER   BY  MEMBER_ID DESC
									) A
							WHERE	ROWNUM &lt;= ?
						)
				WHERE	RNUM &gt;= ?
		</searchEmail>
		<searchAdmin>
				SELECT	*
				FROM	(
							SELECT	ROWNUM AS RNUM
									, A.*
							FROM	(
										SELECT  MEMBER_ID
                                                , NICK_NAME
												, PASSWORD
                                                , EMAIL
                                                , IS_ADMIN
										FROM    MEMBERS
										WHERE	IS_ADMIN = 'Y'
										GROUP   BY  MEMBER_ID
                                                    , NICK_NAME
                                                    , PASSWORD
                                                    , EMAIL
                                                    , IS_ADMIN
										ORDER   BY  MEMBER_ID DESC
									) A
							WHERE	ROWNUM &lt;= ?
						)
				WHERE	RNUM &gt;= ?
		</searchAdmin>
		<allMemberCount>
				SELECT  COUNT(MEMBER_ID)
				FROM	MEMBERS
				WHERE	MEMBER_ID LIKE '%' || ? || '%'
				AND     NICK_NAME LIKE '%' || ? || '%'
		</allMemberCount>
		<searchNickNameCount>
				SELECT  COUNT(MEMBER_ID)
				FROM	MEMBERS
				WHERE	NICK_NAME LIKE '%' || ? || '%'	
		</searchNickNameCount>
		<searchEmailCount>
				SELECT  COUNT(MEMBER_ID)
				FROM	MEMBERS
				WHERE	EMAIL LIKE '%' || ? || '%'
		</searchEmailCount>
		<searchAdminCount>
				SELECT  COUNT(MEMBER_ID)
				FROM	MEMBERS
				WHERE	IS_ADMIN = ?
		</searchAdminCount>
	</member>
	<article>
		<getAllArticleCount>
				SELECT  COUNT(A.ARTICLE_ID)
				FROM	ARTICLES A
					 	, MEMBERS M
				
				WHERE	A.MEMBER_ID = M.MEMBER_ID
				AND		(
							TITLE LIKE '%' || ? || '%'
				OR			DESCRIPT LIKE '%' || ? || '%'			
						)
		</getAllArticleCount>
		<allArticle>
				SELECT	*
				FROM	(SELECT	ROWNUM AS RNUM
									, A.*
							FROM	(
										SELECT  A.ARTICLE_ID
                                                , TITLE
												, NICK_NAME
                                                , HITS
                                                , RECOMMENDS
												, COUNT(FILE_ID) FILE_COUNT
										FROM	ARTICLES A
											 	, MEMBERS M
											 	, FILES F
										WHERE	A.MEMBER_ID = M.MEMBER_ID
										AND     A.ARTICLE_ID = F.ARTICLE_ID(+)
										AND		(
													TITLE LIKE '%' || ? || '%'
										OR			DESCRIPT LIKE '%' || ? || '%'
										
												)
										GROUP   BY  A.ARTICLE_ID
													, TITLE
													, NICK_NAME
													, HITS
													, RECOMMENDS
										ORDER   BY  A.ARTICLE_ID DESC
									) A
							WHERE	ROWNUM &lt;= ?
						)
				WHERE	RNUM &gt;= ?
							
<!-- 			ROWNUM <=3이	
				&lt;= 3를 사용하기 싫다면
				<![CDATA[<=]]>3 형식으로 사용하면 된다. -->
		</allArticle>
	</article>
	<search>
		<searchNickName>	
				SELECT	*
				FROM	(SELECT	ROWNUM AS RNUM
									, A.*
							FROM	(
										SELECT  A.ARTICLE_ID
                                                , TITLE
												, NICK_NAME
                                                , HITS
                                                , RECOMMENDS
												, COUNT(FILE_ID) FILE_COUNT
										FROM	ARTICLES A
											 	, MEMBERS M
											 	, FILES F
										WHERE	A.MEMBER_ID = M.MEMBER_ID
										AND     A.ARTICLE_ID = F.ARTICLE_ID(+)
										AND		NICK_NAME LIKE '%' || ? || '%'
										GROUP   BY  A.ARTICLE_ID
													, TITLE
													, NICK_NAME
													, HITS
													, RECOMMENDS
										ORDER   BY  A.ARTICLE_ID DESC
									) A
							WHERE	ROWNUM &lt;= ?
						)
				WHERE	RNUM &gt;= ?
		</searchNickName>
		<searchMemberId>
				SELECT	*
				FROM	(SELECT	ROWNUM AS RNUM
									, A.*
							FROM	(
										SELECT  A.ARTICLE_ID
                                                , TITLE
												, NICK_NAME
                                                , HITS
                                                , RECOMMENDS
												, COUNT(FILE_ID) FILE_COUNT
										FROM	ARTICLES A
											 	, MEMBERS M
											 	, FILES F
										WHERE	A.MEMBER_ID = M.MEMBER_ID
										AND     A.ARTICLE_ID = F.ARTICLE_ID(+)
										AND		MEMBER_ID LIKE '%' || ? || '%'
										GROUP   BY  A.ARTICLE_ID
													, TITLE
													, NICK_NAME
													, HITS
													, RECOMMENDS
										ORDER   BY  A.ARTICLE_ID DESC
									) A
							WHERE	ROWNUM &lt;= ?
						)
				WHERE	RNUM &gt;= ?
		</searchMemberId>
		
		<getSearchNickNameCount>
				SELECT  COUNT(A.ARTICLE_ID)
				FROM	ARTICLES A
					 	, MEMBERS M
				WHERE	A.MEMBER_ID = M.MEMBER_ID
				AND		M.NICK_NAME LIKE '%' || ? || '%'
		</getSearchNickNameCount>
		<getSearchMemberIdCount>
				SELECT  COUNT(A.ARTICLE_ID)
				FROM	ARTICLES A
					 	, MEMBERS M
				WHERE	A.MEMBER_ID = M.MEMBER_ID
				AND		M.MEMBER_ID LIKE '%' || ? || '%'
		</getSearchMemberIdCount>
	</search>
	<detail>
		<getDetail>
				SELECT  A.*
	       				,M.NICK_NAME
				FROM    ARTICLES A
				        ,MEMBERS M
				WHERE   A.MEMBER_ID = M.MEMBER_ID
				AND     A.ARTICLE_ID = ?
		</getDetail>
		<getHit>
			UPDATE  ARTICLES
			SET     HITS = (HITS+1)
			WHERE   ARTICLE_ID = ?
			AND		MEMBER_ID != ?
		</getHit>
		<getRecommend>
			UPDATE	ARTICLES
			SET		RECOMMENDS = (RECOMMENDS+1)
			WHERE	ARTICLE_ID = ?
		</getRecommend>
		<getDelete>
			DELETE
			FROM    ARTICLES 
			WHERE   ARTICLE_ID = ?
		</getDelete>
	</detail>
	<write>
		<getWrite>
			INSERT INTO ARTICLES (
                        ARTICLE_ID
                        , MEMBER_ID
                        , TITLE
                        , DESCRIPT
                     ) 
			VALUES ( 
			            ARTICLE_ID_SEQ.NEXTVAL
			            , ?
			            , ?
			            , ?
			       )
		</getWrite>
		<getReturnArticleId>
			SELECT	ARTICLE_ID_SEQ.CURRVAL
			FROM	DUAL
		</getReturnArticleId>
		<updateArticleOnlyTitle>
			UPDATE	ARTICLES
			SET		TITLE = ?
			WHERE	ARTICLE_ID = ?
		</updateArticleOnlyTitle>
		<updateArticleOnlyDescript>
			UPDATE	ARTICLES
			SET		DESCRIPT = ?
			WHERE	ARTICLE_ID = ?
		</updateArticleOnlyDescript>
		<updateArticle>
			UPDATE	ARTICLES
			SET		TITLE = ?
					, DESCRIPT = ?
			WHERE	ARTICLE_ID = ?
		</updateArticle>
		<deleteArticle>
			DELETE
			FROM	ARTICLES
			WHERE	ARTICLE_ID = ?
		</deleteArticle>
	</write>
		<file>
		<insertFile>
			INSERT	INTO	FILES	( 
										FILE_ID
										, ARTICLE_ID
										, FILE_NAME
										, FILE_LOCATION
									)
			VALUES 					(
										FILE_ID_SEQ.NEXTVAL
										, ?
										, ?
										, ?
									)
		</insertFile>
		<getFileListByArticleId>
			SELECT	FILE_ID
					, FILE_NAME
					, FILE_LOCATION
			FROM	FILES
			WHERE	ARTICLE_ID = ?
		</getFileListByArticleId>
	</file>
	<reply>
		<insertReply>
			INSERT	INTO	REPLIES	(
										REPLY_ID
										, ARTICLE_ID
										, MEMBER_ID
										, DESCRIPTION
										, GROUP_ID
										, PARENT_REPLY_ID
										, DEPTH
										, ORDER_NO
									) 
			VALUES					(
										REPLY_ID_SEQ.NEXTVAL
										, ?
										, ?
										, ?
										, REPLY_ID_SEQ.CURRVAL
										, 0
										, 0
										, 0
									)
		</insertReply>
		<insertReReply>
			INSERT	INTO	REPLIES	(
										REPLY_ID
										, ARTICLE_ID
										, MEMBER_ID
										, DESCRIPTION
										, GROUP_ID
										, PARENT_REPLY_ID
										, DEPTH
										, ORDER_NO
									) 
			VALUES					(
										REPLY_ID_SEQ.NEXTVAL
										, ?
										, ?
										, ?
										, ?
										, ?
										, ?
										, ?
									)
		</insertReReply>
		<getReplyListByArticleId>
            SELECT	REPLY_ID
					, ARTICLE_ID
					, M.MEMBER_ID
					, NICK_NAME
					, DESCRIPTION
					, GROUP_ID
					, PARENT_REPLY_ID
					, DEPTH
					, ORDER_NO
			FROM	REPLIES R
					, MEMBERS M
			WHERE	R.MEMBER_ID = M.MEMBER_ID
			AND		R.ARTICLE_ID = ?
			ORDER	BY GROUP_ID ASC
					, ORDER_NO ASC
		</getReplyListByArticleId>
		<selectCountParentReplyId>
			SELECT	COUNT(REPLY_ID)
			FROM	REPLIES
			WHERE	PARENT_REPLY_ID = ?
		</selectCountParentReplyId>
		<selectMaxOrderNoByParentReplyId>
			SELECT	MAX(ORDER_NO)
						FROM	REPLIES
						START	WITH REPLY_ID = ?
						CONNECT	BY PRIOR REPLY_ID = PARENT_REPLY_ID
						ORDER	BY	ORDER_NO	DESC	
		</selectMaxOrderNoByParentReplyId>
		<selectLatestOrderNoByParentReplyId>
			SELECT	ORDER_NO
			FROM	REPLIES
			WHERE	REPLY_ID = ?
		</selectLatestOrderNoByParentReplyId>
		<updateOrderNoByGroupId>
			UPDATE	REPLIES
			SET		ORDER_NO = ORDER_NO + 1
			WHERE	ORDER_NO >= ?
			AND		GROUP_ID = ?
		</updateOrderNoByGroupId>
	</reply>
</query>